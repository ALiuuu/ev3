package com.aliu.ev3.ev3.main;import android.content.Context;import android.content.Intent;import android.os.Bundle;import android.util.Log;import android.view.View;import android.widget.Button;import android.widget.EditText;import android.widget.ImageView;import android.widget.TextView;import android.widget.Toast;import com.aliu.ev3.R;import com.aliu.ev3.ev3.CoreApplication;import com.aliu.ev3.ev3.OutDialog;import com.aliu.ev3.ev3.bluetooth.Ev3BtManager;import com.aliu.ev3.ev3.weather.output.WeatherManager;import com.aliu.ev3.ev3.weather.output.bean.WeatherBean;import java.text.SimpleDateFormat;import java.util.Date;import androidx.appcompat.app.ActionBar;import androidx.appcompat.app.AppCompatActivity;import androidx.viewpager.widget.ViewPager;public class SendActivity extends AppCompatActivity {    private static final String TAG = "EV3Numberic";    // ����Intentʱʹ�õ������룬�ж��Ƿ������豸���Ƿ������豸����    private static final int REQUEST_CONNECT_DEVICE = 1;//    private TextView mTvState;//    private TextView mTvName;    Button mConnectButton;    private String boxName = "abc";    private EditText mEt;    private Button   mBtSend;    private TextView  mTvWeather;    private TextView  mTvTemperature;    private TextView  mTvTips;    private TextView  mTvLocation;    private ImageView mIvWeather;    private BoxBean   boxBean;    private ViewPager mVpClothes;    private ViewPager mVpPants;    private ViewPager mVpShoes;    private VpAdapter clothesAdapter;    private VpAdapter pantsAdapter;    private VpAdapter shoesAdapter;    private VpFakeAdapter p1clothAdapter = new VpFakeAdapter(this, new int[]{R.drawable.fake1_clothes1, R.drawable.fake1_clothes2});    private VpFakeAdapter p1pantsAdapter = new VpFakeAdapter(this, new int[]{R.drawable.fake1_pants1, R.drawable.fake1_pants2});    private VpFakeAdapter p1shoesAdapter = new VpFakeAdapter(this, new int[]{R.drawable.fake1_shoes1, R.drawable.fake1_shoes2});    private VpFakeAdapter p2clothAdapter = new VpFakeAdapter(this, new int[]{R.drawable.fake2_clothes1, R.drawable.fake2_clothes2, R.drawable.fake2_clothes3});    private VpFakeAdapter p2pantsAdapter = new VpFakeAdapter(this, new int[]{R.drawable.fake2_pants1, R.drawable.fake2_pants2, R.drawable.fake2_pants3});    private VpFakeAdapter p2shoesAdapter = new VpFakeAdapter(this, new int[]{R.drawable.fake2_shoes3, R.drawable.fake2_shoes2, R.drawable.fake2_shoes1});    ;    private VpFakeAdapter p3clothAdapter = new VpFakeAdapter(this, new int[]{R.drawable.fake3_clothes1, R.drawable.fake3_clothes2});    private VpFakeAdapter p3pantsAdapter = new VpFakeAdapter(this, new int[]{R.drawable.fake3_pants1, R.drawable.fake3_pants2});    private VpFakeAdapter p3shoesAdapter = new VpFakeAdapter(this, new int[]{R.drawable.fake3_shoes1, R.drawable.fake3_shoes2});    private int       targetvalue;    private OutDialog lockDialog;    private ImageView iv1;    private ImageView iv2;    private ImageView iv3;    private ImageView iv4;    private View      v1;    private View      v2;    private View      v3;    private View      v4;    private boolean canClick;    public static void open(Context context) {        Intent i = new Intent(context, SendActivity.class);        context.startActivity(i);    }    @Override    public void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        // 隐藏系统标题栏        ActionBar actionBar = getSupportActionBar();        if (actionBar != null)            actionBar.hide();        if (CoreApplication.isPad) {            setContentView(R.layout.main_pad);        } else {            setContentView(R.layout.main);        }//        mTvState = findViewById(R.id.tv_state);//        mTvName = findViewById(R.id.tv_name);        mTvWeather = findViewById(R.id.tv_weather);        mTvTemperature = findViewById(R.id.tv_temperature);        mIvWeather = findViewById(R.id.iv_weather);        mTvTips = findViewById(R.id.tv_tips);        mTvLocation = findViewById(R.id.tv_location);        WeatherManager.getInstance().getWeahter(new WeatherManager.WeatherListener() {            @Override            public void onSuccess(WeatherBean weatherBean) {                mTvWeather.setText(weatherBean.weather);                mTvTemperature.setText(weatherBean.temperature + "°");                mIvWeather.setImageResource(weatherBean.res);            }            @Override            public void onFailed(String msg) {                mTvWeather.setText("获取失败");                mTvTemperature.setText(msg);            }        });//        getTips();////        if (mTvTips != null) {//            mTvTips.setOnClickListener(new View.OnClickListener() {//                @Override//                public void onClick(View view) {//                    getTips();//                }//            });//        }//        if (mTvLocation != null) {//            mTvLocation.setOnClickListener(new View.OnClickListener() {//                @Override//                public void onClick(View view) {//                    getTips();//                }//            });//        }        TextView viewById = findViewById(R.id.tv_date);        viewById.setText(getTime());        init();    }    private void getTips(){        WeatherManager.getInstance().getTips(new WeatherManager.TipsListener() {            @Override            public void onSuccess(TipsBean tipsBean) {                if (mTvTips != null) {                    mTvTips.setText("     " + tipsBean.getTips());                }                if (mTvLocation != null) {                    mTvLocation.setText("" + tipsBean.getLocation());                }            }            @Override            public void onFailed(String msg) {                if (mTvTips != null) {                    mTvTips.setText("获取失败 点击刷新");                }                if (mTvLocation != null) {                    mTvLocation.setText("获取失败 点击刷新");                }            }        });    }    @Override    protected void onResume() {        super.onResume();        Ev3BtManager.getInstance().start();    }    @Override    public void onStart() {        super.onStart();    }    @Override    public void onBackPressed() {    }    private void init() {        Log.d(TAG, "init()");//        mEt = findViewById(R.id.et);//        mBtSend = findViewById(R.id.bt_send);//        mBtSend.setOnClickListener(v -> {//            String trim = mEt.getText().toString().trim();//            if (!TextUtils.isEmpty(trim)) {////                int i = Integer.parseInt(trim);////                Log.e(TAG, "send: " + i);////                Log.e(TAG, "state: " + mEV3Service.getState());//                Ev3BtManager.getInstance().sendMsg(boxName, trim + "");//            }//        });        boxBean = new BoxBean();        lockDialog = new OutDialog(this, boxBean);        findViewById(R.id.bt1).setOnClickListener(v -> {            if (!canClick) {                return;            }            Integer free = boxBean.getFree();            if (free != -1) {                targetvalue = free;                Ev3BtManager.getInstance().sendMsg(boxName, "" + targetvalue);                Intent intent = new Intent(SendActivity.this, PutActivity.class);                intent.putExtra(PutActivity.REQUEST_CODE, PutActivity.CLOTHES_CODE);                startActivityForResult(intent, PutActivity.CLOTHES_CODE);//                boxBean.putClothes(new BoxBean.ItemBean(free, ""));//                clothesAdapter.notifyDataSetChanged();            } else {                Toast.makeText(this, "格子已满", Toast.LENGTH_SHORT).show();            }        });        findViewById(R.id.bt2).setOnClickListener(v -> {            if (!canClick) {                return;            }            Integer free = boxBean.getFree();            if (free != -1) {                targetvalue = free;                Ev3BtManager.getInstance().sendMsg(boxName, "" + targetvalue);                Intent intent = new Intent(SendActivity.this, PutActivity.class);                intent.putExtra(PutActivity.REQUEST_CODE, PutActivity.PANTS_CODE);                startActivityForResult(intent, PutActivity.PANTS_CODE);//                boxBean.putPants(new BoxBean.ItemBean(free, ""));//                pantsAdapter.notifyDataSetChanged();            } else {                Toast.makeText(this, "格子已满", Toast.LENGTH_SHORT).show();            }        });        findViewById(R.id.bt3).setOnClickListener(v -> {            if (!canClick) {                return;            }            Integer free = boxBean.getFree();            if (free != -1) {                targetvalue = free;                Ev3BtManager.getInstance().sendMsg(boxName, "" + targetvalue);                Intent intent = new Intent(SendActivity.this, PutActivity.class);                intent.putExtra(PutActivity.REQUEST_CODE, PutActivity.SHOES_CODE);                startActivityForResult(intent, PutActivity.SHOES_CODE);//                boxBean.putShoes(new BoxBean.ItemBean(free, ""));//                shoesAdapter.notifyDataSetChanged();            } else {                Toast.makeText(this, "格子已满", Toast.LENGTH_SHORT).show();            }        });        mVpClothes = findViewById(R.id.vp_clothes);        mVpPants = findViewById(R.id.vp_pants);        mVpShoes = findViewById(R.id.vp_shoes);        clothesAdapter = new VpAdapter(this, boxBean.clothes, new VpAdapter.VpListener() {            @Override            public void onclick(int id) {                lockDialog.show(id, clothesAdapter);            }        });        pantsAdapter = new VpAdapter(this, boxBean.pants, new VpAdapter.VpListener() {            @Override            public void onclick(int id) {                lockDialog.show(id, pantsAdapter);            }        });        shoesAdapter = new VpAdapter(this, boxBean.shoes, new VpAdapter.VpListener() {            @Override            public void onclick(int id) {                lockDialog.show(id, shoesAdapter);            }        });        mVpClothes.setAdapter(clothesAdapter);        mVpPants.setAdapter(pantsAdapter);        mVpShoes.setAdapter(shoesAdapter);        canClick = true;        //头像        iv1 = findViewById(R.id.iv_manhead_1);        iv2 = findViewById(R.id.iv_manhead_2);        iv3 = findViewById(R.id.iv_manhead_3);        iv4 = findViewById(R.id.iv_manhead_4);        //头像        v1 = findViewById(R.id.v_manhead_1);        v2 = findViewById(R.id.v_manhead_2);        v3 = findViewById(R.id.v_manhead_3);        v4 = findViewById(R.id.v_manhead_4);        v1.setOnClickListener(v -> {            v1.setVisibility(View.INVISIBLE);            v2.setVisibility(View.VISIBLE);            v3.setVisibility(View.VISIBLE);            v4.setVisibility(View.VISIBLE);            mVpClothes.setAdapter(p1clothAdapter);            mVpPants.setAdapter(p1pantsAdapter);            mVpShoes.setAdapter(p1shoesAdapter);            canClick = false;        });        v2.setOnClickListener(v -> {            v1.setVisibility(View.VISIBLE);            v2.setVisibility(View.INVISIBLE);            v3.setVisibility(View.VISIBLE);            v4.setVisibility(View.VISIBLE);            mVpClothes.setAdapter(p2clothAdapter);            mVpPants.setAdapter(p2pantsAdapter);            mVpShoes.setAdapter(p2shoesAdapter);            canClick = false;        });        v3.setOnClickListener(v -> {            v1.setVisibility(View.VISIBLE);            v2.setVisibility(View.VISIBLE);            v3.setVisibility(View.INVISIBLE);            v4.setVisibility(View.VISIBLE);            mVpClothes.setAdapter(p3clothAdapter);            mVpPants.setAdapter(p3pantsAdapter);            mVpShoes.setAdapter(p3shoesAdapter);            canClick = false;        });        v4.setOnClickListener(v -> {            v1.setVisibility(View.VISIBLE);            v2.setVisibility(View.VISIBLE);            v3.setVisibility(View.VISIBLE);            v4.setVisibility(View.INVISIBLE);            mVpClothes.setAdapter(clothesAdapter);            mVpPants.setAdapter(pantsAdapter);            mVpShoes.setAdapter(shoesAdapter);            canClick = true;        });    }    @Override    protected void onPause() {        super.onPause();    }    @Override    public void onStop() {        super.onStop();    }    @Override    public void onDestroy() {        super.onDestroy();        // ֹͣ��������        Ev3BtManager.getInstance().destory();    }    public void onActivityResult(int requestCode, int resultCode, Intent data) {        if (targetvalue == -1) {            return;        }        switch (requestCode) {            case PutActivity.CLOTHES_CODE:                Ev3BtManager.getInstance().sendMsg(boxName, "-1");                if (resultCode == PutActivity.RESULT_CANCEL) {                    Toast.makeText(this, "取消选择", Toast.LENGTH_SHORT).show();                    targetvalue = -1;                } else if (resultCode == PutActivity.RESULT_CHOSE) {                    int intExtra = data.getIntExtra(PutActivity.RESULT_CODE, 0);                    boxBean.putClothes(new BoxBean.ItemBean(targetvalue, "", intExtra));                    clothesAdapter.notifyDataSetChanged();                    mVpClothes.setCurrentItem(boxBean.clothes.size() - 1);                } else if (resultCode == PutActivity.RESULT_CAMAER) {                    String stringExtra = data.getStringExtra(PutActivity.RESULT_CODE);                    boxBean.putClothes(new BoxBean.ItemBean(targetvalue, stringExtra, 0));                    clothesAdapter.notifyDataSetChanged();                    mVpClothes.setCurrentItem(boxBean.clothes.size() - 1);                }                break;            case PutActivity.PANTS_CODE:                Ev3BtManager.getInstance().sendMsg(boxName, "-1");                if (resultCode == PutActivity.RESULT_CANCEL) {                    Toast.makeText(this, "取消选择", Toast.LENGTH_SHORT).show();                    targetvalue = -1;                } else if (resultCode == PutActivity.RESULT_CHOSE) {                    int intExtra = data.getIntExtra(PutActivity.RESULT_CODE, 0);                    boxBean.putPants(new BoxBean.ItemBean(targetvalue, "", intExtra));                    pantsAdapter.notifyDataSetChanged();                    mVpPants.setCurrentItem(boxBean.pants.size() - 1);                } else if (resultCode == PutActivity.RESULT_CAMAER) {                    String stringExtra = data.getStringExtra(PutActivity.RESULT_CODE);                    boxBean.putPants(new BoxBean.ItemBean(targetvalue, stringExtra, 0));                    pantsAdapter.notifyDataSetChanged();                    mVpPants.setCurrentItem(boxBean.pants.size() - 1);                }                break;            case PutActivity.SHOES_CODE:                Ev3BtManager.getInstance().sendMsg(boxName, "-1");                if (resultCode == PutActivity.RESULT_CANCEL) {                    Toast.makeText(this, "取消选择", Toast.LENGTH_SHORT).show();                    targetvalue = -1;                } else if (resultCode == PutActivity.RESULT_CHOSE) {                    int intExtra = data.getIntExtra(PutActivity.RESULT_CODE, 0);                    boxBean.putShoes(new BoxBean.ItemBean(targetvalue, "", intExtra));                    shoesAdapter.notifyDataSetChanged();                    mVpShoes.setCurrentItem(boxBean.shoes.size() - 1);                } else if (resultCode == PutActivity.RESULT_CAMAER) {                    String stringExtra = data.getStringExtra(PutActivity.RESULT_CODE);                    boxBean.putShoes(new BoxBean.ItemBean(targetvalue, stringExtra, 0));                    shoesAdapter.notifyDataSetChanged();                    mVpShoes.setCurrentItem(boxBean.shoes.size() - 1);                }                break;        }    }    private String getTime() {        SimpleDateFormat formatter = new SimpleDateFormat("MM/dd");        String dateString = formatter.format(new Date());        return dateString;    }}